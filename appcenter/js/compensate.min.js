/*!
 * project : compensate
 * author : LINOFFICE
 * 보상 안내
 */ let purchase_container=[];function purchase_all_select(){let s=$("#purchase_list .purchase_item");s&&("전체선택"===$("#all_select").text()?($("#all_select").text("전체해제"),$.each(s,function(s,a){let e=$(a).find(".item_check"),c=e.prop("checked");if(!c){let p=$(a).attr("data-id"),n=Number($(a).attr("data-price")),l=Number(commaRemove($("#expected_ncoin em").text()));e.prop("checked",!0);for(var t=0;t<purchaseItems.length;t++)if(purchaseItems[t].itemObjectId==p){purchase_container.push(purchaseItems[t]);break}$("#expected_ncoin em").text(commaAdd(l+n)),$(a).addClass("on")}})):($("#all_select").text("전체선택"),$.each(s,function(s,a){let e=$(a).find(".item_check"),c=e.prop("checked");if(c){let p=$(a).attr("data-id"),n=Number($(a).attr("data-price")),l=Number(commaRemove($("#expected_ncoin em").text()));e.prop("checked",!1);for(var t=0;t<purchase_container.length;t++)if(purchase_container[t].itemObjectId==p){purchase_container.splice(t,1);break}$("#expected_ncoin em").text(commaAdd(l-n)),$(a).removeClass("on")}})))}function show_purchaseItems(){let s=purchaseItems.map((s,a)=>'<li class="purchase_item" data-id="'+s.itemObjectId+'" data-enchant="'+s.enchant+'" data-elemental="'+s.elemental+'" data-bless="'+s.bless+'" data-price="'+s.price+'"><div class="left_div"><img src="/img/item/'+s.icon+'.png"><span class="desc">'+s.descryption+'</span><span class="price">'+commaAdd(s.price)+'</span></div><input type="checkbox" class="item_check" disabled></li>').join("");$(".current_status").prepend('<div id="purchase_container"><div class="top"><span class="top_title">매입 가능 보유 아이템 '+purchaseItems.length+' 개</span><button id="all_select" onClick="purchase_all_select();">전체선택</button></div><div id="purchase_list" class="scrollbar-macosx"><ul>'+s+'</ul></div><div class="bottom"><div id="purchase_btn"><button onClick="purchase_confirm();">매입하기</button></div><div id="expected_ncoin">매입 예상 총 금액<em>0</em></div></div></div>')}$(function(){$(".wrap_contents_support .ncoin_status .ncoin").text(account?commaAdd(account.ncoin):"로그인 후 확인할 수 있습니다."),purchaseItems&&purchaseItems.length&&show_purchaseItems();let s=$(".pur_item_list_info");$(".pur_item_list button.list_show").on("click",function(a){s.hasClass("on")?s.removeClass("on"):s.addClass("on")}),$(".pur_item_list button.list_close").on("click",function(a){s.removeClass("on")}),$("#purchase_list .purchase_item").on("click",function(s){let a=$(this).find(".item_check"),e=a.prop("checked"),c=$(this).attr("data-id"),p=Number($(this).attr("data-price")),n=Number(commaRemove($("#expected_ncoin em").text()));if(e){a.prop("checked",!1);for(var l=0;l<purchase_container.length;l++)if(purchase_container[l].itemObjectId==c){purchase_container.splice(l,1);break}$("#expected_ncoin em").text(commaAdd(n-p)),$(this).removeClass("on")}else{a.prop("checked",!0);for(var l=0;l<purchaseItems.length;l++)if(purchaseItems[l].itemObjectId==c){purchase_container.push(purchaseItems[l]);break}$("#expected_ncoin em").text(commaAdd(n+p)),$(this).addClass("on")}}),$(document).ready(function(){$(".scrollbar-macosx").scrollbar()})});var purchaseLock=!1;function purchase_item(){if(purchaseLock)return;let s="";for(var a=0;a<purchase_container.length;a++)a>0&&(s+="|"),s+=purchase_container[a].itemObjectId;purchaseLock=!0,$(".dimmed").css("display","block"),$("#send_delay").css("display","block");let e={select_items:s};$.ajax({type:"POST",datatype:"json",url:"/define/compensate/purchase",data:e,success:function(s){switch($("#send_delay").css("display","none"),s){case 1:popupShow("정상적으로 완료되었습니다.",'<span class="type2"><a href="javascript:popupCloseReload();" class="close">닫기</a></span>',null);break;case 2:popupShow("인게임에서 이용할 수 있습니다.",'<span class="type2"><a href="javascript:popupClose();" class="close">닫기</a></span>',null);break;case 3:popupShow("계정을 찾을 수 없습니다.",'<span class="type2"><a href="javascript:loginIngame();" class="close">설정</a></span>','<span class="type1"><a href="javascript:popupClose();" class="close">닫기</a></span>');break;case 4:popupShow("대표 캐릭터를 찾을 수 없습니다.",'<span class="type2"><a href="javascript:popupClose();" class="close">닫기</a></span>',null);break;case 5:popupShow("월드 내 캐릭터를 찾을 수 없습니다.",'<span class="type2"><a href="javascript:popupClose();" class="close">닫기</a></span>',null);break;case 6:popupShow("매입 가능 보유 아이템을 찾을 수 없습니다.",'<span class="type2"><a href="javascript:popupClose();" class="close">닫기</a></span>',null);break;case 7:popupShow("선택한 아이템 정보를 전달하지 못하였습니다.",'<span class="type2"><a href="javascript:popupClose();" class="close">닫기</a></span>',null);break;case 8:popupShow("선택한 아이템을 파싱하지 못하였습니다.",'<span class="type2"><a href="javascript:popupClose();" class="close">닫기</a></span>',null);break;case 9:popupShow("인벤토리에서 아이템을 발견하지 못하였습니다.",'<span class="type2"><a href="javascript:popupClose();" class="close">닫기</a></span>',null);break;case 10:popupShow("지금은 이용할 수 있는 기간이 아닙니다.",'<span class="type2"><a href="javascript:popupClose();" class="close">닫기</a></span>',null);break;default:popupShow("매입에 실패하였습니다.",'<span class="type2"><a href="javascript:popupClose();" class="close">닫기</a></span>',null)}purchaseLock=!1},error:function(s,a,e){purchaseLock=!1,$(".dimmed").css("display","none"),$("#send_delay").css("display","none")}})}function purchase_confirm(){if(!account){popupShow("로그인 후 이용할 수 있습니다..",'<span class="type2"><a href="javascript:popupClose();" class="close">닫기</a></span>',null);return}if(!account.ingame){popupShow("인게임에서 이용할 수 있습니다.",'<span class="type2"><a href="javascript:popupClose();" class="close">닫기</a></span>',null);return}if(!purchase_container||!purchase_container.length){popupShow("매입시킬 아이템을 선택하십시오.",'<span class="type2"><a href="javascript:popupClose();" class="close">닫기</a></span>',null);return}popupShow("정말로 매입 시키겠습니까?",'<span class="type2"><a href="javascript:purchase_item();" class="close">예</a></span>','<span class="type1"><a href="javascript:popupClose();" class="close">아니오</a></span>')}var changeLock=!1;function couponChange(){if(changeLock)return;let s="";if($("#to_mail")&&$("#to_mail").val()){if(!is_email_check($("#to_mail").val())){popupShow("이메일이 올바르지 않습니다.",'<span class="type2"><a href="javascript:popupClose();" class="close">닫기</a></span>',null);return}s=$("#to_mail").val()}else s="";let a={to_email:s};$(".dimmed").css("display","block"),$("#send_delay").css("display","block"),changeLock=!0,$.ajax({type:"POST",datatype:"json",url:"/define/compensate",data:a,success:function(s){switch(s.code){case 1:popupShow("발급 쿠폰 번호\r\n"+s.number,'<span class="type2"><a href="javascript:popupClose();" class="close">닫기</a></span>',null),$(".create_number").html('<div class="coupon_number"><strong>발급 쿠폰 번호 : </strong><strong>'+s.number+"</strong></div>"),account.ncoin=0,$(".wrap_contents_support .ncoin_status .ncoin").text("0");break;case 2:popupShow("계정을 찾을 수 없습니다.",'<span class="type2"><a href="javascript:loginIngame();" class="close">설정</a></span>','<span class="type1"><a href="javascript:popupClose();" class="close">닫기</a></span>');break;case 3:popupShow("보유중인 NCOIN이 없습니다.",'<span class="type2"><a href="javascript:popupClose();" class="close">닫기</a></span>',null);break;case 4:popupShow("메일 전송에 실패하였습니다.",'<span class="type2"><a href="javascript:popupClose();" class="close">닫기</a></span>',null);break;case 5:popupShow("지금은 이용할 수 있는 기간이 아닙니다.",'<span class="type2"><a href="javascript:popupClose();" class="close">닫기</a></span>',null);break;default:popupShow("등록에 실패하였습니다.",'<span class="type2"><a href="javascript:popupClose();" class="close">닫기</a></span>',null)}changeLock=!1,$(".dimmed").css("display","none"),$("#send_delay").css("display","none")},error:function(s,a,e){changeLock=!1,$(".dimmed").css("display","none"),$("#send_delay").css("display","none")}})}function change_confirm(){if(!account){popupShow("로그인 후 이용할 수 있습니다.",'<span class="type2"><a href="javascript:popupClose();" class="close">확인</a></span>',null);return}if(!account.ncoin){popupShow("보유중인 NCOIN이 없습니다.",'<span class="type2"><a href="javascript:popupClose();" class="close">확인</a></span>',null);return}if(purchaseItems&&purchaseItems.length){popupShow("매입할 아이템이 존재합니다.<br>바로 환전 하시겠습니까?",'<span class="type2"><a href="javascript:couponChange();" class="close">예</a></span>','<span class="type1"><a href="javascript:popupClose();" class="close">아니오</a></span>');return}popupShow("정말로 환전 하시겠습니까?",'<span class="type2"><a href="javascript:couponChange();" class="close">예</a></span>','<span class="type1"><a href="javascript:popupClose();" class="close">아니오</a></span>')}
