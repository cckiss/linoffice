/*!
 * project : trade
 * author : LINOFFICE
 * 거래소
 */ function openBankPopup(){if(!account){popupShow("로그인 후 이용 가능합니다.</br>로그인 하시겠습니까?",'<span class="type2"><a href="javascript:login();" class="close">예</a></span>','<span class="type1"><a href="javascript:popupClose();" class="close">아니오</a></span>');return}openPopup("/bank",480,650,"bankForm",1,0,!1)}function openTradeRegistPopup(){if(!account){popupShow("로그인 후 이용 가능합니다.</br>로그인 하시겠습니까?",'<span class="type2"><a href="javascript:login();" class="close">예</a></span>','<span class="type1"><a href="javascript:popupClose();" class="close">아니오</a></span>');return}if(!account.ingame){popupShow("인게임에서 등록할 수 있습니다.",'<span class="type2"><a href="javascript:popupClose();" class="close">확인</a></span>',null);return}if(!bank){popupShow("계좌등록 후 이용할 수 있습니다.",'<span class="type2"><a href="javascript:popupClose();" class="close">확인</a></span>',null);return}openPopup("/trade/regist",480,650,"tradeRegistForm",1,0,!1)}function get_trade(a){return trade_items?trade_items.find(s=>s.id==a):null}function close_detail(){$(".dimmed").fadeOut(),$("#trade_item_detail_view").removeClass("is_active")}$(function(){$("#searchForm #SearchInput").val(query||"1억 아데나 수표"),account&&account.firstChar&&$(".top_wrap").append(`<div class="seller_area"><div class="seller_btn"><button type="button" class="seller_items">나의 상품 보기</button><button type="button" class="reg_item">상품 등록 하기</button></div></div><div class="bank_area"><button type="button" class="reg_bank">${bank?`계좌 변경`:`계좌 등록`}</button></div>`);let a=$(".pagination-container");function s(s){a.pagination({dataSource:s,pageSize:18,showPrevious:!1,showNext:!1,showPageNumbers:!0,callback:function(a,s){let e="";a.length?$.each(a,function(a,s){e+=`<div class="sub_card"><div class="box ${s.status_code}" id="displayGoodsData">`+(account&&account.gm?`<div class="btn_delete"><button onClick="delete_item(${s.id});">삭제</button></div>`:"")+`<a href="javascript:view_detail(${s.id});" class="lnk_detail">`+`<div class="img_area"><img src="/img/item/${s.itemVO.invgfx}.png" alt="" class="item_img"></div>`+'<div class="item_info"><div class="v_align">'+`<div class="tit_area"><em class="tit">${s.description}</em></div>`+`<div class="coin_area"><span class="won">${commaAdd(s.price)}</span></div>`+"</div></div></a>"+`<div class="btn_area">${function a(s){switch(s.status_code){case"REGIST":return account&&account.firstChar&&account.firstChar.name===s.seller_name?`<a href="javascript:cancelConfirm(${s.id});" class="btn direct fn_orderform">판매취소</a>`:`<a href="javascript:buyConfirm(${s.id});" class="btn direct fn_orderform">구매신청</a>`;case"TRADING":return account&&account.firstChar&&account.firstChar.name===s.seller_name?`<a href="javascript:completeConfirm(${s.id});" class="btn direct fn_orderform">입금완료</a>`:account&&account.firstChar&&account.firstChar.name===s.buyer_name?`<a href="javascript:buyCancelConfirm(${s.id});" class="btn direct fn_orderform">구매취소</a>`:`<a class="btn direct fn_orderform">거래중</a>`;case"COMPLETE":return`<a class="btn direct fn_orderform">거래완료</a>`;case"CANCEL":return`<a class="btn direct fn_orderform">취소상품</a>`;case"ERROR":return`<a class="btn direct fn_orderform">오류상품</a>`}}(s)}</div>`+"</div></div>"}):e+=`<div class="search_not_found"><em>판매 중인 상품이 없습니다.</em><p>검색어의 철자가 정확한지 확인해주세요.<br> 검색어가 두 단어 이상일 경우, 띄어쓰기를 확인해주세요.</p></div>`,$(".data-loader").css("display","none"),$(".sub_wrap").html(e)}})}var e=$("#SearchInput"),l=$("#searchPanel").find(".btn_search");e.focus(function(){$(this).addClass("on"),$(this).val("")}),$(".gnb .btn_area .btn_reset").on("click",function(a){e.val(""),e.focus()}),l.click(function(){var a=document.searchForm;a.query.value||(a.query.value=""),a.submit()}),$(".reg_bank").on("click",function(a){openBankPopup()}),$(".seller_items").on("click",function(e){let l=$(this).html();a.destory,"나의 상품 보기"===l?(s(seller_items),$(this).text("전체 보기")):(s(trade_items),$(this).text("나의 상품 보기"))}),$(".reg_item").on("click",function(a){openTradeRegistPopup()});var t=$(".ui-dropdown"),c=$(".ui-dropdown-custom_items");t.on("click",function(a){$(this).hasClass("is-active")?t.removeClass("is-active"):(t.removeClass("is-active"),$(this).addClass("is-active"))}),c.on("click",function(e){let l=$(this).attr("data-textvalue"),t=$(this).attr("data-value");if(l===$(".ui-dropdown.is-active .select").find("span").html()||($(".ui-dropdown.is-active .select").find("span").html(l),!trade_items))return;let c=[];for(var p=0;p<trade_items.length;p++)("ALL"==t||trade_items[p].status_code==t)&&c.push(trade_items[p]);a.destory,s(c)}),$("body").mouseup(function(a){var s=$("#searchPanel");!e.has(a.target).length&&!s.has(a.target).length&&e.hasClass("on")&&e.removeClass("on"),!t.has(a.target).length&&!c.has(a.target).length&&t.hasClass("is-active")&&t.removeClass("is-active");var l=$("#trade_item_detail_view");!l.has(a.target).length&&l.hasClass("is_active")&&close_detail(),eventStop(a)}),s(trade_items)});const ELEMENT_DESC=["없음","화령 1단","화령 2단","화령 3단","화령 4단","화령 5단","수령 1단","수령 2단","수령 3단","수령 4단","수령 5단","풍령 1단","풍령 2단","풍령 3단","풍령 4단","풍령 5단","지령 1단","지령 2단","지령 3단","지령 4단","지령 5단"];function view_detail(a){var s=get_trade(a);if(!s)return;let e=$("#trade_item_detail_view");if(e.hasClass("is_active"))return;let l=s.status_code,t=`<div class="icon"><img src="/img/item/${s.itemVO.invgfx}.png" alt="" class="item_img"></div>`;switch(t+=`<table><tbody><tr><th style="width: 25%;">구분</th><th style="width: 75%;">내용</th></tr></tbody><tbody>`,t+=`<tr><td class="td_key">판매명</td><td class="td_val">${s.description}</td></tr>`,t+=`<tr><td class="td_key">가격</td><td class="td_val price">${commaAdd(s.price)}</td></tr>`,t+=`<tr><td class="td_key">아이템</td><td class="td_val">${s.itemVO.name}</td></tr>`,t+=`<tr><td class="td_key">개수</td><td class="td_val">${commaAdd(s.amount)}</td></tr>`,t+=`<tr><td class="td_key">축복</td><td class="td_val">${"BLESS"==s.bless_code?`축복`:"CURSE"==s.bless_code?`저주`:`일반`}</td></tr>`,t+=`<tr><td class="td_key">인챈트</td><td class="td_val">${s.enchant_level}</td></tr>`,t+=`<tr><td class="td_key">속성</td><td class="td_val">${ELEMENT_DESC[s.element_level]}</td></tr>`,t+=`<tr><td class="td_key">잠재력</td><td class="td_val">${s.potential_id>0?s.potential_desc:`없음`}</td></tr>`,t+=`<tr><td class="td_key">판매자</td><td class="td_val">${s.seller_name}</td></tr>`,t+=`<tr><td class="td_key">등록일</td><td class="td_val">${s.regist_date}</td></tr>`,t+=`<tr><td class="td_key">구매자</td><td class="td_val">${s.buyer_name?s.buyer_name:"-"}</td></tr>`,t+=`<tr><td class="td_key">완료일</td><td class="td_val">${s.complete_date?s.complete_date:"-"}</td></tr>`,t+=`<tr><td class="td_key">상태</td><td class="td_val">${"COMPLETE"==l?`거래완료`:"TRADING"==l?`거래중`:"CANCEL"==l?`취소상품`:"ERROR"==l?`오류상품`:`판매상품`}</td></tr>`,t+="</tbody></table>",l){case"REGIST":account&&account.firstChar&&account.firstChar.name===s.seller_name?t+=`<div class="btn"><button type="button" onClick="close_detail(); cancelConfirm(${s.id});">판매취소</button></div>`:t+=`<div class="btn"><button type="button" onClick="close_detail(); buyConfirm(${s.id});">구매신청</button></div>`;break;case"TRADING":account&&account.firstChar&&(account.firstChar.name===s.seller_name?t+=`<div class="btn"><button type="button" onClick="close_detail(); completeConfirm(${s.id});">입금완료</button></div>`:account.firstChar.name===s.buyer_name&&(t+=`<div class="btn"><button type="button" onClick="close_detail(); buyCancelConfirm(${s.id});">구매취소</button></div>`))}e.children(".info").html(t),e.addClass("is_active"),$(".dimmed").fadeIn()}let delete_lock=!1;function delete_item(a){account&&account.gm&&confirm("정말로 삭제하시겠습니까?")&&!delete_lock&&(delete_lock=!0,getDatasWithOption([{type:"POST",url:"/define/trade/delete",dataType:"json",contentType:"application/json",Accept:"application/json",data:{id:a}}],a=>{popupShow(a?"정상적으로 삭제되었습니다.":"삭제에 실패하였습니다.",'<span class="type2"><a href="javascript:popupCloseReload();" class="close">닫기</a></span>',null),delete_lock=!1},a=>{delete_lock=!1}))}function buyValidation(){return account?account.ingame?!!bank||(popupShow("계좌등록 후 이용할 수 있습니다.",'<span class="type2"><a href="javascript:popupClose();" class="close">닫기</a></span>',null),!1):(popupShow("인게임에서 구매신청할 수 있습니다.",'<span class="type2"><a href="javascript:popupClose();" class="close">닫기</a></span>',null),!1):(popupShow("로그인 후 이용 가능합니다.</br>로그인 하시겠습니까?",'<span class="type2"><a href="javascript:login();" class="close">예</a></span>','<span class="type1"><a href="javascript:popupClose();" class="close">아니오</a></span>'),!1)}function buyConfirm(a){if(!buyValidation())return;let s=get_trade(a);if(!s){popupShow("구매신청할 상품을 발견하지 못했습니다.",'<span class="type2"><a href="javascript:popupClose();" class="close">확인</a></span>',null);return}if("REGIST"!=s.status_code){popupShow("해당 상품은 구매신청할 수 없는 상품입니다.",'<span class="type2"><a href="javascript:popupCloseReload();" class="close">확인</a></span>',null);return}if(account.name==s.seller_acccount_name){popupShow("같은 계정내 캐릭터는 구매신청할 수 없습니다.",'<span class="type2"><a href="javascript:popupClose();" class="close">확인</a></span>',null);return}popupShow("정말로 구매신청하시겠습니까?",`<span class="type2"><a href="javascript:tradeBuy(${a});" class="close">예</a></span>`,`<span class="type1"><a href="javascript:popupClose();" class="close">아니오</a></span>`)}var buyLock=!1;function tradeBuy(a){!buyLock&&(buyLock=!0,getDatasWithOption([{type:"POST",url:"/define/trade/buy",dataType:"json",contentType:"application/json",Accept:"application/json",data:{id:a}}],a=>{switch(a){case 1:popupShow("구매신청이 완료되었습니다.<br>판매자 정보가 편지로 전송되었습니다.",'<span class="type2"><a href="javascript:popupCloseReload();" class="close">닫기</a></span>',null);break;case 2:popupShow("인게임에서 구매신청할 수 있습니다.",'<span class="type2"><a href="javascript:popupClose();" class="close">닫기</a></span>',null);break;case 3:popupShow("계정 정보를 찾을 수 없습니다.",'<span class="type2"><a href="javascript:loginIngame();" class="close">설정</a></span>','<span class="type1"><a href="javascript:popupClose();" class="close">닫기</a></span>');break;case 4:popupShow("대표 캐릭터를 찾을 수 없습니다.",'<span class="type2"><a href="javascript:loginIngame();" class="close">설정</a></span>','<span class="type1"><a href="javascript:popupClose();" class="close">닫기</a></span>');break;case 5:popupShow("월드 내 캐릭터를 찾을 수 없습니다.",'<span class="type2"><a href="javascript:loginIngame();" class="close">설정</a></span>','<span class="type1"><a href="javascript:popupClose();" class="close">닫기</a></span>');break;case 6:popupShow("계좌등록 후 이용할 수 있습니다.",'<span class="type2"><a href="javascript:popupClose();" class="close">닫기</a></span>',null);break;case 7:popupShow("등록된 물품을 발견하지 못하였습니다.",'<span class="type2"><a href="javascript:popupCloseReload();" class="close">닫기</a></span>',null);break;case 8:popupShow("해당 물품은 구매할 수 없습니다.",'<span class="type2"><a href="javascript:popupCloseReload();" class="close">닫기</a></span>',null);break;case 9:popupShow("판매자가 접속중이지 않습니다.",'<span class="type2"><a href="javascript:popupClose();" class="close">닫기</a></span>',null);break;case 10:popupShow("판매자 계좌정보를 발견하지 못하였습니다.",'<span class="type2"><a href="javascript:popupClose();" class="close">닫기</a></span>',null);break;default:popupShow("구매신청에 실패하였습니다.",'<span class="type2"><a href="javascript:popupCloseReload();" class="close">닫기</a></span>',null)}buyLock=!1},a=>{buyLock=!1}))}function close_cancel(){$(".dimmed").fadeOut(),$("#trade_cancel_descryption").removeClass("is_active")}function buyCancelConfirm(a){let s=get_trade(a);if(!s){popupShow("구매취소할 상품을 발견하지 못했습니다.",'<span class="type2"><a href="javascript:popupClose();" class="close">확인</a></span>',null);return}if("TRADING"!=s.status_code){popupShow("해당 상품은 구매취소할 수 없는 상품입니다.",'<span class="type2"><a href="javascript:popupCloseReload();" class="close">확인</a></span>',null);return}if(account.firstChar.name!=s.buyer_name){popupShow("구매 신청 캐릭터만 취소할 수 있습니다.",'<span class="type2"><a href="javascript:popupClose();" class="close">확인</a></span>',null);return}let e=$("#trade_cancel_descryption");if(e.hasClass("is_active"))return;let l=`<div><label>구매취소 사유</label><input type="text" name="cancel_descryption" id="cancel_descryption" autocomplete="off" placeholder="구매취소 사유를 입력하십시오." maxlength="100" /></div>`;l+=`<div class="btn"><button type="button" onClick="buyCancelDescryptionForm(${a});">구매취소</button></div>`,e.children(".info").html(l),e.addClass("is_active"),$(".dimmed").fadeIn()}function buyCancelDescryptionForm(a){if(!$("#cancel_descryption").val()){$("#cancel_descryption").focus();return}close_cancel(),popupShow("정말로 구매취소 하시겠습니까?",`<span class="type2"><a href="javascript:tradeBuyCancel(${a});" class="close">예</a></span>`,`<span class="type1"><a href="javascript:popupClose();" class="close">아니오</a></span>`)}var buyCancelLock=!1;function tradeBuyCancel(a){if(buyCancelLock)return;buyCancelLock=!0;let s=$("#cancel_descryption").val();getDatasWithOption([{type:"POST",url:"/define/trade/buyCancel",dataType:"json",contentType:"application/json",Accept:"application/json",data:{id:a,cancel_descryption:s}}],a=>{switch(a){case 1:popupShow("구매취소가 완료되었습니다.",'<span class="type2"><a href="javascript:popupCloseReload();" class="close">닫기</a></span>',null);break;case 2:popupShow("계정 정보를 찾을 수 없습니다.",'<span class="type2"><a href="javascript:loginIngame();" class="close">설정</a></span>','<span class="type1"><a href="javascript:popupClose();" class="close">닫기</a></span>');break;case 3:popupShow("대표 캐릭터를 찾을 수 없습니다.",'<span class="type2"><a href="javascript:loginIngame();" class="close">설정</a></span>','<span class="type1"><a href="javascript:popupClose();" class="close">닫기</a></span>');break;case 4:popupShow("등록된 물품을 발견하지 못하였습니다.",'<span class="type2"><a href="javascript:popupCloseReload();" class="close">닫기</a></span>',null);break;case 5:popupShow("해당 물품은 구매취소할 수 없습니다.",'<span class="type2"><a href="javascript:popupCloseReload();" class="close">닫기</a></span>',null);break;case 6:popupShow("구매 신청자만 취소할 수 있습니다.",'<span class="type2"><a href="javascript:popupCloseReload();" class="close">닫기</a></span>',null);break;default:popupShow("구매취소에 실패하였습니다.",'<span class="type2"><a href="javascript:popupCloseReload();" class="close">닫기</a></span>',null)}buyCancelLock=!1},a=>{buyCancelLock=!1})}function completeValidation(){return account?!!account.ingame||(popupShow("인게임에서 진행할 수 있습니다.",'<span class="type2"><a href="javascript:popupClose();" class="close">닫기</a></span>',null),!1):(popupShow("로그인 후 이용 가능합니다.</br>로그인 하시겠습니까?",'<span class="type2"><a href="javascript:login();" class="close">예</a></span>','<span class="type1"><a href="javascript:popupClose();" class="close">아니오</a></span>'),!1)}function completeConfirm(a){if(!completeValidation())return;let s=get_trade(a);if(!s){popupShow("완료할 물품을 발견하지 못했습니다.",'<span class="type2"><a href="javascript:popupClose();" class="close">확인</a></span>',null);return}if("TRADING"!=s.status_code){popupShow("해당 물품은 거래중인 물품이 아닙니다.",'<span class="type2"><a href="javascript:popupCloseReload();" class="close">확인</a></span>',null);return}popupShow("정말로 입금완료 하시겠습니까?",`<span class="type2"><a href="javascript:tradeComplete(${a});" class="close">예</a></span>`,`<span class="type1"><a href="javascript:popupClose();" class="close">아니오</a></span>`)}var completeLock=!1;function tradeComplete(a){!completeLock&&(completeLock=!0,getDatasWithOption([{type:"POST",url:"/define/trade/complete",dataType:"json",contentType:"application/json",Accept:"application/json",data:{id:a}}],a=>{switch(a){case 1:popupShow("거래가 정상적으로 완료되었습니다.",'<span class="type2"><a href="javascript:popupCloseReload();" class="close">닫기</a></span>',null);break;case 2:popupShow("인게임에서 진행할 수 있습니다.",'<span class="type2"><a href="javascript:popupClose();" class="close">닫기</a></span>',null);break;case 3:popupShow("계정 정보를 찾을 수 없습니다.",'<span class="type2"><a href="javascript:loginIngame();" class="close">설정</a></span>','<span class="type1"><a href="javascript:popupClose();" class="close">닫기</a></span>');break;case 4:popupShow("대표 캐릭터를 찾을 수 없습니다.",'<span class="type2"><a href="javascript:loginIngame();" class="close">설정</a></span>','<span class="type1"><a href="javascript:popupClose();" class="close">닫기</a></span>');break;case 5:popupShow("월드 내 캐릭터를 찾을 수 없습니다.",'<span class="type2"><a href="javascript:loginIngame();" class="close">설정</a></span>','<span class="type1"><a href="javascript:popupClose();" class="close">닫기</a></span>');break;case 6:case 10:popupShow("등록된 물품을 발견하지 못하였습니다.",'<span class="type2"><a href="javascript:popupCloseReload();" class="close">닫기</a></span>',null);break;case 7:popupShow("자신의 물품이 아닙니다.",'<span class="type2"><a href="javascript:popupClose();" class="close">닫기</a></span>',null);break;case 8:popupShow("해당 물품은 거래중인 물품이 아닙니다.",'<span class="type2"><a href="javascript:popupCloseReload();" class="close">닫기</a></span>',null);break;case 9:popupShow("구매자가 접속중이지 않습니다.",'<span class="type2"><a href="javascript:popupClose();" class="close">닫기</a></span>',null);break;case 11:popupShow("물품의 상태를 변경하지 못하였습니다.",'<span class="type2"><a href="javascript:popupClose();" class="close">닫기</a></span>',null);break;case 12:popupShow("구매자에게 물품을 전달하지 못하였습니다.",'<span class="type2"><a href="javascript:popupClose();" class="close">닫기</a></span>',null);break;default:popupShow("입금완료에 실패하였습니다.",'<span class="type2"><a href="javascript:popupCloseReload();" class="close">닫기</a></span>',null)}completeLock=!1},a=>{completeLock=!1}))}function cancelValidation(){return account?account.ingame?!!account.firstChar||(popupShow("대표 캐릭터가 선택되지 않았습니다.",'<span class="type2"><a href="javascript:popupClose();" class="close">닫기</a></span>',null),!1):(popupShow("인게임에서 취소할 수 있습니다.",'<span class="type2"><a href="javascript:popupClose();" class="close">닫기</a></span>',null),!1):(popupShow("로그인 후 이용 가능합니다.</br>로그인 하시겠습니까?",'<span class="type2"><a href="javascript:login();" class="close">예</a></span>','<span class="type1"><a href="javascript:popupClose();" class="close">아니오</a></span>'),!1)}function cancelConfirm(a){if(!cancelValidation())return;let s=get_trade(a);if(!s){popupShow("취소할 물품을 발견하지 못했습니다.",'<span class="type2"><a href="javascript:popupClose();" class="close">확인</a></span>',null);return}if(account.firstChar.name!=s.seller_name){popupShow("해당 물품의 소유자가 아닙니다.",'<span class="type2"><a href="javascript:popupClose();" class="close">확인</a></span>',null);return}if("REGIST"!=s.status_code){popupShow("해당 물품은 취소할 수 없습니다.",'<span class="type2"><a href="javascript:popupCloseReload();" class="close">확인</a></span>',null);return}popupShow("정말로 취소하시겠습니까?",`<span class="type2"><a href="javascript:tradeCancel(${a});" class="close">예</a></span>`,`<span class="type1"><a href="javascript:popupClose();" class="close">아니오</a></span>`)}var cancelLock=!1;function tradeCancel(a){!cancelLock&&(cancelLock=!0,getDatasWithOption([{type:"POST",url:"/define/trade/cancel",dataType:"json",contentType:"application/json",Accept:"application/json",data:{id:a}}],a=>{switch(a){case 1:popupShow("취소가 정상적으로 완료되었습니다.</br></br>취소된 아이템은 인벤토리에 지급되었습니다.",'<span class="type2"><a href="javascript:popupCloseReload();" class="close">닫기</a></span>',null);break;case 2:popupShow("인게임에서 취소할 수 있습니다.",'<span class="type2"><a href="javascript:popupClose();" class="close">닫기</a></span>',null);break;case 3:popupShow("계정 정보를 찾을 수 없습니다.",'<span class="type2"><a href="javascript:loginIngame();" class="close">설정</a></span>','<span class="type1"><a href="javascript:popupClose();" class="close">닫기</a></span>');break;case 4:popupShow("대표 캐릭터를 찾을 수 없습니다.",'<span class="type2"><a href="javascript:loginIngame();" class="close">설정</a></span>','<span class="type1"><a href="javascript:popupClose();" class="close">닫기</a></span>');break;case 5:popupShow("월드 내 캐릭터를 찾을 수 없습니다.",'<span class="type2"><a href="javascript:loginIngame();" class="close">설정</a></span>','<span class="type1"><a href="javascript:popupClose();" class="close">닫기</a></span>');break;case 6:popupShow("존재하지 않는 물품입니다.",'<span class="type2"><a href="javascript:popupCloseReload();" class="close">닫기</a></span>',null);break;case 7:popupShow("해당 물품은 취소할수 없습니다.",'<span class="type2"><a href="javascript:popupCloseReload();" class="close">닫기</a></span>',null);break;case 8:popupShow("해당 물품의 소유자가 아닙니다.",'<span class="type2"><a href="javascript:popupCloseReload();" class="close">닫기</a></span>',null);break;default:popupShow("취소에 실패하였습니다.",'<span class="type2"><a href="javascript:popupCloseReload();" class="close">닫기</a></span>',null)}cancelLock=!1},a=>{cancelLock=!1}))}
