/*!
 * project : websocket
 * author : LINOFFICE
 * 웹소켓
 */ let ws_handler;class WebSocketHandler{ws=null;url=null;callback=null;reconnect_max_count=10;constructor(s,t){if(!s||ws_handler||!t)return!1;this.url="ingame"===device?s.ingame_url:s.url,this.callback=t}connect(){if(!this.url){popupShow("웹소켓 서버 비활성화 상태입니다.",'<span class="type2"><a href="javascript:popupClose();" class="close">닫기</a></span>',null);return}if(this.is_open()){popupShow(`웹소켓이 이미 활성화 되어 있습니다. STATE : ${this.ws.readyState}`,'<span class="type2"><a href="javascript:popupClose();" class="close">닫기</a></span>',null);return}this.ws=new WebSocket(this.url),this.ws.onopen=s=>{this.callback.on_open(s)},this.ws.onmessage=s=>{this.callback.on_message(s)},this.ws.onclose=s=>{this.callback.on_close(s),s.wasClean||this.reconnect()},this.ws.onerror=s=>{console.log(s)}}reconnect(){!(--this.reconnect_max_count<0)&&setTimeout(()=>{this.connect()},1e3)}close(){this.ws&&(this.ws.close(),this.ws=null)}is_connecting(){return this.ws&&this.ws.readyState==WebSocket.CONNECTING}is_open(){return this.ws&&this.ws.readyState==WebSocket.OPEN}is_closing(){return this.ws&&this.ws.readyState==WebSocket.CLOSING}is_closed(){return this.ws&&this.ws.readyState==WebSocket.CLOSED}send(s,t){this.is_open()&&this.ws.send(s+JSON.stringify(t))}}
