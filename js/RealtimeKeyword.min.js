class RealtimeKeyword{constructor(e){let t=this;if(!e)return;t.INTERVAL_ROLLING_ITEMS=3500,t.option=$.extend(!0,{service:"search",wrap:null,data:null,alias:null,serverId:1,global:window},e),t.global=t.option.global?t.option.global:window,t.data=null,t.alias=null,t.wrap=null,t.rollingWrap=null,t.rollingKeywordWrap=null,t.rollingItemInterval=null,t.rollingItemIndex=1,t.listWrap=null,t.listKeywordWrap=null,t.uniqueId=Date.now(),t.proxy={clickDocumentEventHandler:null},t.init()}init(){let e=this;return e.wrap=$(e.option.wrap),isDefined(e.wrap)&&e.wrap.length&&(e.data=e.option.data?e.option.data.list:[],e.data.length&&(e.rollingWrap=$(".keyword__rolling",e.wrap),e.listWrap=$(".keyword__list",e.wrap),e.rollingKeywordWrap=$(".keyword",e.rollingWrap),e.listKeywordWrap=$(".keyword",e.listWrap),e.proxy.clickDocumentEventHandler=$.proxy(e.clickDocumentEventHandler,e),e.setInstance())),e}setInstance(){let e=this,t,l,r="",a="";for(let n=0,i=e.data.length;n<i;++n){function o(t){let l;switch(e.option.alias){case"search-powerbook":l="powerbook";break;case"search-community":l="community";break;case"search-faq":l="faq";break;default:l="index"}return l}if(a=encodeURIComponent((t=e.data[n])[0]),l={index:n+1,name:t[0],updown:t[1],rank:t[2],url:""},"-"===a)l.url="javascript:;";else switch(e.option.service){case"search":l.url=`/search?query=${a}`;break;case"item":l.url=`/my/item-search?keyword=${a}`;break;case"powerbook":l.url=`/powerbook/search?query=${a}`}r+=e.getListTpl(l)}e.rollingKeywordWrap.empty().append(r),e.listKeywordWrap.empty().append(r),e.setRollingKeywords(),e.setToggleBtn(),e.setWrapVisible(!1)}setRollingKeywords(){tram($("li",this.rollingKeywordWrap)).set({position:"absolute",top:0,left:0,y:this.rollingKeywordWrap.height()}),this.changeItem(this.rollingItemIndex),this.setRollingKeywordInterval(!0)}setRollingKeywordInterval(e){let t=this;if(t.global.clearInterval(t.rollingItemInterval),t.rollingItemInterval=null,truthy(e)){let l=$("li",t.rollingKeywordWrap);t.rollingItemInterval=t.global.setInterval(()=>{let e=t.rollingItemIndex+1;e>l.length&&(e=1),t.changeItem(e),t.rollingItemIndex=e},t.INTERVAL_ROLLING_ITEMS)}}changeItem(e){let t=this.rollingKeywordWrap.height(),l=this.rollingItemIndex,r=$("li",this.rollingKeywordWrap),a=$(r.get(l-1)),n=$(r.get(e-1));a.length&&tram(a).stop({y:!0}).add("transform 0.9s ease-out-expo").start({y:-t}),n.length&&tram(n).stop({y:!0}).set({y:t}).add("transform 0.9s ease-out-expo").start({y:0})}getListTpl(e){return`<li><a href="${e.url}">${e.name}</a><span class="ui-rank ${e.updown}">${e.rank}</span></li>`}setToggleBtn(){let e=this;$(".btn-toggle",e.wrap).on("click",t=>{t.preventDefault();let l=e.listWrap.is(":visible");e.setDocumentEventHandler(!l),e.setWrapVisible(!l)})}setWrapVisible(e){truthy(e)?(this.wrap.addClass("on"),this.showListWrap(!0)):(this.wrap.removeClass("on"),this.showListWrap(!1))}showListWrap(e){truthy(e)?this.listWrap.show():this.listWrap.hide()}setDocumentEventHandler(e){return $(document).off(`click.ui.realtimekeyword.${this.uniqueId}`,this.proxy.clickDocumentEventHandler),truthy(e)&&$(document).on(`click.ui.realtimekeyword.${this.uniqueId}`,this.proxy.clickDocumentEventHandler),this}clickDocumentEventHandler(e){if("click"===e.type){let t=$(".btn-toggle",this.wrap).get(0),l=$(".keyword__list",this.wrap).get(0);if(e.target===t||e.target===l||$.contains(l,e.target))return;this.setDocumentEventHandler(!1),this.setWrapVisible(!1)}return this}}function searchRealtimeKeyword(e){if(!e)return;let t=document.createElement("script");t.src=`/js/popularkeyword.js?${getTime}`,t.addEventListener("load",t=>{let l=document.createElement("script");l.src=`https://cdn.jsdelivr.net/gh/cckiss/web/js/tram.js?${cacheVersion}`,l.addEventListener("load",t=>{new RealtimeKeyword($.extend(e,{data:popularKeyword}))}),document.body.appendChild(l)}),document.body.appendChild(t)}
