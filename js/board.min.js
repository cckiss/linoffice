/*!
 * project : board
 * author : LINOFFICE
 * 게시판
 */ function get_board_uri_flag(){switch(boardType){case"BOARD":return"/board";case"CONTENTS":return"/contents";case"PITCH":return"/pitch";default:throw Error("get_board_uri_flag from board.js Error")}}function get_report_flag(){switch(boardType){case"BOARD":return"게시글_ID_";case"CONTENTS":return"컨텐츠공모_ID_";case"PITCH":return"홍보_ID_";default:return""}}function commentLengthCheck(e){$(e).val().length>300&&$(e).val($(e).val().substr(0,300)),$(".count-word > em").text($(e).val().length)}function reportBtn(e){if(!account){popupShow("로그인 후 이용하실 수 있습니다.",'<span class="type2"><a href="javascript:popupClose();" class="close">닫기</a></span>',null);return}reportModalOpen($(e),get_report_flag()+$(e).attr("data-boardid"))}function commentReportBtn(e){if(!account){popupShow("로그인 후 이용하실 수 있습니다.",'<span class="type2"><a href="javascript:popupClose();" class="close">닫기</a></span>',null);return}reportModalOpen($(e),get_report_flag()+$(e).attr("data-boardid")+"_코멘트_ID_"+$(e).attr("data-commentid"))}function reportModalOpen(e,a){$("#ncCommunityReport .report-target .target").html(e.attr("data-name")),$("#reportLog").val(a),$("#ncCommunityReportModal").addClass("is-active"),$("#ncCommunityReport").addClass("is-active")}function reportModalClose(){$("#ncCommunityReportModal").removeClass("is-active"),$("#ncCommunityReport").removeClass("is-active")}function reportInsert(e){if(!account){popupShow("로그인 후 이용하실 수 있습니다.",'<span class="type2"><a href="javascript:popupClose();" class="close">닫기</a></span>',null);return}let a=$("input:radio[name=reportCase]:checked").val(),t=$("#reportLog").val(),s=$("#ncCommunityReport .report-target .target").html();getDatasWithOption([{type:"POST",url:"/define/report/insert",dataType:"json",contentType:"application/json",Accept:"application/json",data:{targetName:s,type:a,log:t}}],e=>{popupShow(e,'<span class="type2"><a href="javascript:popupClose();" class="close">닫기</a></span>',null),reportModalClose()},e=>{throw Error("reportInsert from board.js Error")})}function likeBtn(e){if(!account){popupShow("로그인 후 이용하실 수 있습니다.",'<span class="type2"><a href="javascript:popupClose();" class="close">닫기</a></span>',null);return}boardLikeBtn($(e),"/define/board/like",{board_type:boardType,id:$(e).attr("data-id")})}function commentLikeBtn(e){if(!account){popupShow("로그인 후 이용하실 수 있습니다.",'<span class="type2"><a href="javascript:popupClose();" class="close">닫기</a></span>',null);return}boardLikeBtn($(e),"/define/board/commentLike",{board_type:boardType,id:$(e).attr("data-commentid"),boardnum:$(e).attr("data-boardnum")})}function boardLikeBtn(e,a,t){getDatasWithOption([{type:"POST",url:a,dataType:"json",contentType:"application/json",Accept:"application/json",data:t}],a=>{var t=Number($(e).find("em").html())+Number(a);$(e).find("em").html(t),1==a?$(e).addClass("is-active"):-1==a&&$(e).removeClass("is-active")},e=>{throw Error("boardLikeBtn from board.js Error")})}function boardCommentWrite(){var e=$(".comment-form-textarea > textarea");if(!e.val().length){popupShow("댓글을 작성해주세요.",'<span class="type2"><a href="javascript:popupClose();" class="close">닫기</a></span>',null);return}let a=$("#ncCommunityView").attr("data-board-id"),t=$("#ncCommunityView").attr("data-board-num"),s={board_type:boardType,content:e.val(),boardId:a};getDatasWithOption([{type:"POST",url:"/define/board/commentInsert",dataType:"json",contentType:"application/json",Accept:"application/json",data:s}],a=>{if(a){var s=`<div class="comment-article" data-commentid="${a.id}"><div class="comment-info"><span class="thumb"><img src="https://cdn.jsdelivr.net/gh/cckiss/web${a.profileUrl}" alt=""></span><span class="writer">${a.name}<span class="server">${serverName}</span></span><span class="date">${moment(new Date(a.date)).format("YYYY. MM. DD. HH:mm:ss")}</span><button class="co-btn btn-declare" data-commentid="${a.id}" data-boardnum="${t}" data-name="${a.name}" aria-label="신고" onClick="commentReportBtn(this);">&nbsp;신고</button><button class="co-btn btn-delete" aria-label="삭제" onClick="deleteComment(this, ${a.id});">&nbsp;삭제</button></div><div class="comment-contents">${a.content}</div><div class="comment-utils"><button data-commentid="${a.id}" data-boardnum="${t}" class="co-btn co-btn-like" aria-label="좋아요수" onClick="commentLikeBtn(this);"><svg class="fe-svg fe-svg-like_s" style="width: 16px; height: 16px; vertical-align: middle; fill: rgba(0,0,0,.45)!important; color: rgba(0,0,0,.45)!important;"><use xlink:href="#fe-svg-like_s"></use></svg>&nbsp;<em class="text">${a.likenames?a.likenames.length:0}</em></button></div></div>`;$(s).appendTo(".commentThread"),$(".comment-article-none").remove(),e.val("");var n=$(".commentTotalCount");n.html(Number(n.html())+1)}else popupShow("고객님께서는 계정 또는 대표캐릭터 미설정 상태거나 이용제한 상태입니다.",'<span class="type2"><a href="javascript:popupClose();" class="close">닫기</a></span>',null)},e=>{throw Error("boardCommentWrite from board.js")})}function deleteComment(e,a){popupShow(`댓글을 삭제하시겠습니까?`,`<span class="type2"><a href="javascript:popupClose();" class="close">아니오</a></span>`,`<span class="type1"><a href="javascript:deleteCommentAction(${a});" class="close">예</a></span>`)}function deleteCommentAction(e){getDatasWithOption([{type:"POST",url:"/define/board/commentDelete",dataType:"json",contentType:"application/json",Accept:"application/json",data:{board_type:boardType,id:e}}],a=>{if(a){var t=$(".comment-article");$(t).each(function(a,s){t.eq(a).attr("data-commentid")==e&&s.remove()}),popupClose();var s=$(".commentTotalCount");s.html(Number(s.html())-1),0>=Number(s.html())&&$(".commentThread").html('<div class="comment-article-none"><p>첫 댓글을 남겨주세요.</p></div>')}else popupShow("댓글 삭제에 실패하였습니다.",'<span class="type2"><a href="javascript:popupClose();" class="close">닫기</a></span>',null)},e=>{throw Error("deleteCommentAction from board.js Error")})}$(function(){includeHTML(document.querySelector("#svg-container"),"https://cdn.jsdelivr.net/gh/cckiss/web/svg.html");var e=$(".ui-dropdown"),a=$(".ui-dropdown-custom_items"),t=$(".co-btn-reset"),s=$(".btn-list"),n=$(".btn-cards"),o=$(".ncCommunityBoardList"),r=$(".co-btn-top_list"),i=$(".btn-type-selected");e.on("click",function(e){$(this).toggleClass("is-active")}),a.on("click",function(e){var a=$(this).attr("data-textvalue");$(".ui-dropdown-community.is-active .select").find("span").html(a),$(".ui-dropdown-community.is-active .select").find("#data_val").val($(this).attr("data-value"))}),t.on("click",function(e){$("#ncCommunitySearch").val("")});var l=function(e){if($(".co-btn").removeClass("is-disabled"),"card"==e){s.addClass("is-disabled"),o.hasClass("board-list-default")&&o.removeClass("board-list-default"),$(".ncCommunityBoardList").addClass("board-list-card"),$(".board-type-card").show(),$(".board-type-list").hide(),i.removeClass("list"),i.addClass("card");var a="<svg class='fe-svg fe-svg-card'><use xlink:href='#fe-svg-card'></use></svg>";i.html(a),i.removeClass("is-show")}else{n.addClass("is-disabled"),o.hasClass("board-list-card")&&o.removeClass("board-list-card"),$(".ncCommunityBoardList").addClass("board-list-default"),$(".board-type-list").show(),$(".board-type-card").hide(),i.removeClass("card"),i.addClass("list");var a="<svg class='fe-svg fe-svg-list'><use xlink:href='#fe-svg-list'></use></svg>";i.html(a),i.removeClass("is-show")}};let c="board_free_viewMode";switch(boardType){case"CONTENTS":c="board_content_viewMode";break;case"PITCH":c="board_fitch_viewMode"}s.on("click",function(e){o.hasClass("board-list-card")&&(l("list"),setLocal(c,"list"))}),n.on("click",function(e){o.hasClass("board-list-default")&&(l("card"),setLocal(c,"card"))}),"card"===getLocal("board_free_viewMode")&&l("card"),r.on("click",function(e){$(window).scrollTop(0),e.preventDefault()}),i.on("click",function(e){$(this).toggleClass("is-show")}),$(".input-board-search").on("click",function(e){$("#wrapSearch").addClass("is-show")}),$(".co-btn-clear").on("click",function(e){$("#wrapSearch").removeClass("is-show")}),$(".contentWrite").on("click",function(e){$(this).closest(".comment-form-contentWrite").hasClass("is-active")||(eventStop(e),location.href="/login")}),$(".comment-toolbar > .right > button").on("click",function(e){boardCommentWrite()}),$("#ncCommunityReport .ly-close").on("click",function(e){reportModalClose()}),$("#ncCommunityReport .co-btn-finish").on("click",function(e){reportInsert($(this))}),$("body").mouseup(function(e){!$(".option").has(e.target).length&&!$(".ui-dropdown.is-active").has(e.target).length&&$(".ui-dropdown").hasClass("is-active")&&$(".ui-dropdown").removeClass("is-active"),!$("#wrapSearch").has(e.target).length&&$("#wrapSearch").hasClass("is-show")&&($("#wrapSearch").removeClass("is-show"),$("#ncCommunitySearch").val("")),eventStop(e)});var d=$(".nowCheckvalue");d&&d.length&&$.each(d,function(e,a){if(!a.value){var t=getNowDayTimeToFormat($(this).closest(".board-items").find(".nowCheckdate").val());$(this).closest(".board-items").find(".date").html(t)}})});let more_btn_lock=!1;function boardMore(){if(more_btn_lock)return;let e=$(".nc-community-loader");e.css("display","");var a=$("#totSize").val(),t=$("#cursize").val();more_btn_lock=!0,getDatasWithOption([{type:"POST",url:"/define/board/more",dataType:"json",contentType:"application/json",Accept:"application/json",data:{board_type:boardType,size:t}}],s=>{var n="";$.each(s,function(e,a){n+=createBoardHtml(a)}),$(n).appendTo(".ncCommunityBoardList"),s.length>0&&($("#cursize").val(Number(t)+Number(s.length)),$("#totSize").val(Number(a)-Number(s.length)),0>=$("#totSize").val()?$(".wrap-community-more").html(""):$(".wrap-community-more").html('<button class="nc-comment-more" onClick="javascritp:boardMore();"><span class="txt">더보기</span></button>')),e.css("display","none"),more_btn_lock=!1},a=>{throw e.css("display","none"),more_btn_lock=!1,Error("boardMore from board.js Error")})}function createBoardHtml(e){var a=$(".ncCommunityBoardList"),t="",s="display:none;";a.hasClass("board-list-card")&&(t="display:none;",s="");let n=get_board_uri_flag(),o=moment().format("YYYYMMDD"),r=moment(new Date(e.date)).format("YYYYMMDD"),i=o-r,l=`${"CONTENTS"==boardType?`<span class="category">컨텐츠&nbsp;</span>`:"PITCH"==boardType?`<span class="category">홍보&nbsp;</span>`:""}`;return`<li class="board-items" onClick='urlform("${e.rownum}", "post", "${n}/view");'><div class="title board-type-list" style="${t}">`+l+`<a href='javascript:urlform("${e.rownum}", "post", "${n}/view");'>${e.title}</a>${e.mainImg?'<svg class="fe-svg fe-svg-picture"><use xlink:href="#fe-svg-picture"></use></svg>':""}`+'<div class="count">'+`<span class="count-like" data-count="${e.likenames?e.likenames.length:0}">&nbsp;<svg class="fe-svg fe-svg-like_s"><use xlink:href="#fe-svg-like_s"></use></svg><em>${e.likenames?e.likenames.length:0}</em></span>`+`<span class="count-comment" data-count="${e.answerList?e.answerList.length:0}">&nbsp;<svg class="fe-svg fe-svg-comment"><use xlink:href="#fe-svg-comment"></use></svg><em>${e.answerList?e.answerList.length:0}</em></span>`+`</div>${0===i?'&nbsp<i class="fe-icon-new" data-diff=""></i>':""}`+"</div>"+`<div class="info board-type-list" style="${t}">`+`<span class="writer">${e.type?'<img src="https://cdn.jsdelivr.net/gh/cckiss/web/img/lineage_writer.png" alt="">':`${e.name}<span class="server">${serverName}</span>`}</span>&nbsp`+`<span class="date">${moment(new Date(e.date)).format("YY.MM.DD.")}</span>&nbsp`+`<span class="hit"><em class="txt">조회</em>${e.readcount}</span>`+`<span class="like">추천<em>${e.likenames?e.likenames.length:0}</em></span>`+'</div><div class="comment">'+`<a href='javascript:urlform("${e.rownum}", "post", "${n}/view");'><span><em class="number">${e.answerList?e.answerList.length:0}</em><em class="txt">댓글</em></span></a>`+"</div>"+`<div class="board-type-card" style="${s}">`+`${e.mainImg?`<div class="board-items-thumb"><a href="javascript:urlform("${e.rownum}", "post", "${n}/view");"><img src="${e.mainImg}" alt=""></a></div>`:""}`+'<div class="board-items-contents"><div class="title">'+l+`<a href='javascript:urlform("${e.rownum}", "post", "${n}/view");'>${e.title}${0===i?'&nbsp<i class="fe-icon-new"></i></a>':"</a>"}`+"</div>"+`<div class="desc desc-overflow"><a href='javascript:urlform("${e.rownum}", "post", "${n}/view");'>${e.content}</a></div>`+`<span class="writer">${e.type?'<img src="https://cdn.jsdelivr.net/gh/cckiss/web/img/lineage_writer.png" alt="">':`${e.name}<span class="server">${serverName}</span>`}</span>&nbsp`+'</div><div class="board-items-footer"><div class="info">'+`<span class="writer">${e.name}</span>`+`<span class="date">${moment(new Date(e.date)).format("YY. MM. DD.")}</span>&nbsp`+`<span class="hit-count"><span class="txt">조회 </span><em>${e.readcount}</em></span>`+'</div><div class="count">'+`<span class="count-like" data-count="${e.likenames?e.likenames.length:0}">`+`<svg class="fe-svg fe-svg-like_s"><use xlink:href="#fe-svg-like_s"></use></svg><em>${e.likenames?e.likenames.length:0}</em>`+"</span>"+`<span class="count-comment" data-count="${e.answerList?e.answerList.length:0}">`+`<svg class="fe-svg fe-svg-comment"><use xlink:href="#fe-svg-comment"></use></svg><em>${e.answerList?e.answerList.length:0}</em>`+"</span></div></div></div></li>"}function boardWriteFormCheck(){var e=document.boardWriteForm;return e.title.value?e.content.value?!!maxByteCheck(e.content.value,1):(popupShow("내용을 입력해주세요.",'<span class="type2"><a href="javascript:popupClose();" class="close">닫기</a></span>',null),!1):(popupShow("제목을 입력해주세요.",'<span class="type2"><a href="javascript:popupClose();" class="close">닫기</a></span>',null),!1)}function delectConfirm(e){popupShow("정말로 삭제하시겠습니까?",'<span class="type2"><a href="javascript:popupClose();" class="close">아니오</a></span>','<span class="type1"><a href="javascript:deleteConfirmAction('+e+');" class="close">예</a></span>')}function deleteConfirmAction(e){let a=$(".board-view .view-body").find("img");urlform(e,"post",get_board_uri_flag()+"/delete"+getDeleteImgSrc(a))}function getDeleteImgSrc(e){let a="";if(e&&e.length){a+="?deleteImgList=";for(var t=0;t<e.length;t++)t>0&&(a+=","),a+=e.eq(t).attr("src")}return a}function boardCancel(e){let a=$("#tempList").val(),t=$("#oriContent").val(),s=$("#oriList").val();if(!a&&!s){history.back();return}getDatasWithOption([{type:"POST",url:"update"==e?"/define/editor/updatecancel":"/define/editor/insertcancel",dataType:"json",contentType:"application/json",Accept:"application/json",data:{tempList:a,oriContent:t,oriList:s},cache:!1}],e=>{history.back()},e=>{throw Error("boardCancel from board.js Error")})}
