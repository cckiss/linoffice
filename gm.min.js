/*!
 * project : gm
 * author : LINOFFICE
 * 관리자
 */ var user_container=[],support_container=[],support_request_container=[];let support_tab_type="DEFAULT";var coupon_container=[];function init(){switch(tabType){case"PERFORM":includeHTML(document.querySelector("#page_container"),"/gm/gm_server.html");break;case"USER":$("#page_container").html('<div id="user_data"><div class="user_top"><div class="user_search"><input type="text" id="user_search_name" name="user_search_name" placeholder="검색 캐릭터명" onkeyup="if(window.event.keyCode==13){user_search();}"><button onClick="user_search();">검색</button></div></div><ul class="table-list"></ul><div class="pagination"></div></div>');break;case"SUPPORT":let t="";t="DEFAULT"===support_tab_type?'<div id="support_data"><div class="ui-select-tab select-tab-inventory"><ul class="select-tab option" style="display:block;"><li><a class="selected" href="javascript:support_tab_click(\'DEFAULT\');">후원내역</a></li><li><a class="" href="javascript:support_tab_click(\'REQUEST\');">계좌요청</a></li></ul></div><div class="support_tab_top"><div class="support-select"><div class="ui-dropdown" onClick="$(this).toggleClass(\'is-active\')"><div class="select"><span>전체</span><input type="hidden" name="support_status" id="data_val" value="ALL"/></div><ul class="option"><li class="ui-dropdown-custom_items support-select-items" data-textvalue="전체" data-value="ALL" onClick="dropdown_select(this);">전체</li><li class="ui-dropdown-custom_items support-select-items" data-textvalue="입금완료" data-value="STANBY" onClick="dropdown_select(this);">입금완료</li><li class="ui-dropdown-custom_items support-select-items" data-textvalue="정산완료" data-value="FINISH" onClick="dropdown_select(this);">정산완료</li></ul></div></div></div><ul class="table-list"></ul><div class="pagination"></div></div>':'<div id="support_data"><div class="ui-select-tab select-tab-inventory"><ul class="select-tab option" style="display:block;"><li><a class="" href="javascript:support_tab_click(\'DEFAULT\');">후원내역</a></li><li><a class="selected" href="javascript:support_tab_click(\'REQUEST\');">계좌요청</a></li></ul></div><div class="support_tab_top"><div class="support-select"><div class="ui-dropdown" onClick="$(this).toggleClass(\'is-active\')"><div class="select"><span>전체</span><input type="hidden" name="support_status" id="data_val" value="ALL"/></div><ul class="option"><li class="ui-dropdown-custom_items support-select-items" data-textvalue="전체" data-value="ALL" onClick="dropdown_request_select(this);">전체</li><li class="ui-dropdown-custom_items support-select-items" data-textvalue="미전송" data-value="STANBY" onClick="dropdown_request_select(this);">미전송</li><li class="ui-dropdown-custom_items support-select-items" data-textvalue="전송" data-value="FINISH" onClick="dropdown_request_select(this);">전송</li></ul></div></div></div><ul class="table-list"></ul><div class="pagination"></div><div class="finish_form_div"><div class="finish_form"><span>후원 계좌 정보 작성</span><a class="close" href="javascript:$(\'.finish_form_div\').css(\'display\', \'none\');$(\'.dimmed\').css(\'display\', \'none\');$(\'.support_request_content\').val(\'\');">닫기</a><div><div class="detail-item"><input type="hidden" id="support_request_id" name="support_request_id"><textarea class="support_request_content" name="support_request_content" placeholder="계좌정보를 입력하세요."></textarea></div><div class="requst_submit_btn"><button onClick="javascript:support_request_finish_submit();">전송</button></div></div></div></div></div>',$("#page_container").html(t);break;case"REPORT":$("#page_container").html('<div id="report_data"><div class="restrict_area"><button class="restrict_form_show" onClick="restrict_form_show();">이용제재</button><div class="restrict_form"><div class="restrict_overlay"></div><div class="restrict_input"><div class="desc"><label>제재 계정</label><input type="text" id="restrict_account" name="restrict_account" placeholder="계정명"></div><div class="time"><label>제재 시간</label><input type="date" id="restrict_time" name="restrict_time"></div><div class="restrict_btn"><button class="restrict_cancel" onClick="restrict_cancel();">취소</button><button class="restrict_ok" onClick="restrict_ok();">적용</button></div></div></div></div><ul class="table-list"></ul><div class="pagination"></div></div>');break;case"COUPON":$("#page_container").html('<div id="coupon_data"><div class="coupon_tab_top"><div class="coupon-select"><div class="ui-dropdown" onClick="$(this).toggleClass(\'is-active\');"><div class="select"><span>전체</span><input type="hidden" name="couponType" id="data_val" value="-1"/></div><ul class="option"><li class="ui-dropdown-custom_items coupon-select-items" onClick="dropdown_coupon_select(this);" data-textvalue="전체" data-value="-1">전체</li><li class="ui-dropdown-custom_items coupon-select-items" onClick="dropdown_coupon_select(this);" data-textvalue="사용 전" data-value="0">사용 전</li><li class="ui-dropdown-custom_items coupon-select-items" onClick="dropdown_coupon_select(this);" data-textvalue="사용 완료" data-value="1">사용 완료</li></ul></div></div><button class="coupon-pop-open" onClick="javascript:couponPopOpen();">쿠폰 생성</button></div><table class="table_list ng-scope"><tbody><tr><th width="15%">쿠폰번호</th><th width="18%">쿠폰정보</th><th width="12%">기간</th><th width="10%">발행일</th><th width="10%">발행계정</th><th width="10%">상태</th><th width="10%">사용일</th><th width="10%">소유계정</th><th width="5%">유틸</th></tr></tbody><tbody class="couponList"></tbody></table><div class="pagination"></div></div><div class="coupon-create-pop" style="display: none;"><div class="coupon-create-div"><form name="couponCreateForm" action="#" onsubmit="return couponCreate();" autocomplete="off"><div class="input-area"><div class="coupon-create-area"><label>쿠폰타입</label><div class="coupon-select"><div class="ui-dropdown" onClick="$(this).toggleClass(\'is-active\');"><div class="select"><span>선택</span><input type="hidden" name="couponType" id="data_val"></div><ul class="option"><li class="ui-dropdown-custom_items coupon-create-items" onClick="dropdown_coupon_create_select(this);" data-textvalue="선택" data-value="">선택</li><li class="ui-dropdown-custom_items coupon-create-items" onClick="dropdown_coupon_create_select(this);" data-textvalue="ITEM" data-value="ITEM">ITEM</li><li class="ui-dropdown-custom_items coupon-create-items" onClick="dropdown_coupon_create_select(this);" data-textvalue="NCOIN" data-value="NCOIN">NCOIN</li><li class="ui-dropdown-custom_items coupon-create-items" onClick="dropdown_coupon_create_select(this);" data-textvalue="NPOINT" data-value="NPOINT">NPOINT</li></ul></div></div></div><div class="coupon-create-area itemId" style="display: none"><label>아이템번호</label><input type="number" name="couponItemId" placeholder="아이템번호를 입력하세요.(필수)" /></div><div class="coupon-create-area price"><label>수량설정</label><input type="number" name="couponAmount" placeholder="수량을 입력하세요.(필수)" onKeyup="javascript:couponAmountCheck(this);" /></div><div class="coupon-create-area times"><label>기간설정</label><input type="date" name="couponEnableTime" id="couponEnableTime" max="9999-12-31" />&nbsp;~&nbsp;<input type="date" name="couponExpireTime" id="couponExpireTime" max="9999-12-31" /></div></div></form><div class="btn_area"><button class="btn_create" onClick="javascript:couponCreate();">생성</button><button class="btn_close" onClick="javascript:couponPopClose();">닫기</button></div></div></div><div class="coupon-create-pop-back" style="display: none;"></div>');let e=new Date().toISOString().substring(0,10);$("#couponEnableTime").val(e),$("#couponExpireTime").val(e);break;case"CHAT":$("#page_container").html('<div id="chat_data"><div class="chat_top"><div><h4>관리자 채팅 (명령어에 대한 결과는 출력되지 않습니다.)</h4></div><div id="chat_result"><div id="chat_result_box"><ul class="scrollbar-macosx"></ul></div></div><div class="chat_search"><input type="text" id="chat_to" name="chat_to" placeholder="귓속말"><input type="text" id="chat_param" name="chat_param" placeholder="채팅을 입력하세요." onkeyup="if(window.event.keyCode==13){chat_run();}"><button onClick="chat_run();">보내기</button></div></div></div>'),$("#chat_result_box .scrollbar-macosx").scrollbar()}}var attrDesc=["","화령:1단의 ","화령:2단의 ","화령:3단의 ","화령:4단의 ","화령:5단의 ","수령:1단의 ","수령:2단의 ","수령:3단의 ","수령:4단의 ","수령:5단의 ","풍령:1단의 ","풍령:2단의 ","풍령:3단의 ","풍령:4단의 ","풍령:5단의 ","지령:1단의 ","지령:2단의 ","지령:3단의 ","지령:4단의 ","지령:5단의 ",],getItemName=function(t,e,s){return e<0?attrDesc[s]+e+" "+t:e>0?attrDesc[s]+"+"+e+" "+t:attrDesc[s]+t},getBlessStatus=function(t){switch(t){case 0:return" status-bless";case 2:return" status-curse";default:return""}};function delete_user_item(t,e){if(confirm("선택하신 아이템을 삭제하시겠습니까?")){for(var s,a=0;a<user_container.length;a++)if(user_container[a].name===t){s=user_container[a];break}if(!s){alert("유저 데이터를 특정하지 못하였습니다.");return}$.ajax({type:"post",datatype:"json",url:"/define/gm/deleteitem",data:{user_name:t,item_id:e},success:function(t){if(t){for(var a=0;a<s.inventory.length;a++)if(s.inventory[a].id===e){s.inventory.splice(a,1);break}let n=$("#item_"+e).closest(".inv_info").find(".inv_count");n.html(s.inventory.length),$("#item_"+e).remove(),alert("정상적으로 삭제 되었습니다.")}else alert("삭제에 실패하였습니다.")},error:function(t,e,s){throw Error("delete_user_item from gm.js Error")}})}}function ban_user(t,e){confirm("계정이 밴 처리됩니다.\r\n선택하신 유저를 추방 하시겠습니까?")&&$.ajax({type:"post",datatype:"json",url:"/define/gm/banuser",data:{user_name:t},success:function(t){switch(t){case 1:alert("정상적으로 추방 되었습니다.");break;case 2:alert("해당 캐릭터는 접속중이지 않습니다.");break;case 5:alert("이미 추방된 유저입니다.");break;default:alert("추방에 실패하였습니다.")}},error:function(t,e,s){throw Error("ban_user from gm.js Error")}})}function del_user(t,e,s){confirm("선택하신 유저를 삭제 하시겠습니까?")&&$.ajax({type:"post",datatype:"json",url:"/define/gm/deleteuser",data:{acc_name:t,user_name:e},success:function(t){if(1===t){for(var e=0;e<user_container.length;e++)if(user_container[e].objId===s){user_container.splice(e,1);break}$("#user_"+s).remove(),alert("정상적으로 삭제 되었습니다.")}else alert("삭제에 실패하였습니다.")},error:function(t,e,s){throw Error("del_user from gm.js Error")}})}function user_search(){let t=$("#user_search_name").val();if(!t){$(".pagination").destory,user_render(user_container);return}$(".pagination").destory;let e=[];for(var s=0;s<user_container.length;s++)user_container[s].name.includes(t)&&e.push(user_container[s]);user_render(e),$("#user_search_name").val("")}function get_user_detail_inv(t){return t.inventory?t.inventory.map((e,s)=>'<li id="item_'+e.id+'"><img src="/img/item/'+e.item.invgfx+'.png" alt="" onerror="this.src=\'/img/shop/noimg.gif\'" class="thumb"><strong class="name'+getBlessStatus(e.bless)+'">'+getItemName(e.item.name,e.enchant,e.attr)+" ("+commaAdd(e.count)+')</strong><a class="del" href="javascript:delete_user_item(\''+t.name+"', "+e.id+')">삭제</a></li>').join(""):'<div class="nodata">보유중인 아이템이 없습니다.</div>'}function get_user_detail(t){return"<div class=\"user_detail\"><button class=\"close\" onClick=\"$(this).parent('.user_detail').css('display', 'none'); $('.dimmed').css('display', 'none');\">X</button><div class=\"detail_img\"><img src=\""+t.profileUrl+'"></div><div class="detail_box"><div class="detail_title"><strong>'+t.name+"</strong> | <strong>"+t.level+"Lv</strong> | <strong>"+t.expPercent+"%</strong><span>"+(t.gm?"관리자":"")+'</span></div><div class="detail_pledge"><strong>PLEDGE:</strong><span>'+(void 0!==t.clanName&&""!==t.clanName?t.clanName:"-")+'</span></div><div class="detail_account"><strong>ACCOUNT:</strong><span>'+t.accountName+'</span></div><div class="detail_inv"><strong>INVENTORY:</strong><span class="inv_info"><i class="inv_count">'+t.inventory.length+'</i>개 보유<div class="detail_inv_list"><div class="inv_box"><ul>'+get_user_detail_inv(t)+'</ul></div></div></span></div><div class="detail_stat"><strong>상세스탯</strong><div class="stat_box"><ul><li><strong class="stat_key">STR:</strong><span class="stat_val">'+t.str+'</span></li><li><strong class="stat_key">CON:</strong><span class="stat_val">'+t.con+'</span></li><li><strong class="stat_key">DEX:</strong><span class="stat_val">'+t.dex+'</span></li><li><strong class="stat_key">INT:</strong><span class="stat_val">'+t.intel+'</span></li><li><strong class="stat_key">WIS:</strong><span class="stat_val">'+t.wis+'</span></li><li><strong class="stat_key">CHA:</strong><span class="stat_val">'+t.cha+'</span></li></ul></div></div><div class="detail_event"><button class="ban_btn" onClick="javascript:ban_user(\''+t.name+"', "+t.objId+');">추방</button><button class="del_btn" onClick="javascript:del_user(\''+t.accountName+"', '"+t.name+"', "+t.objId+');">삭제</button></div></div></div>'}function user_render(t){$(".pagination").pagination({dataSource:t,pageSize:20,showPrevious:!1,showNext:!1,showPageNumbers:!0,callback:function(t,e){var s="";t&&t.length?$.each(t,function(t,e){s+='<li class="users" id="user_'+e.objId+"\"><div class=\"simple\" onClick=\"$(this).parent('.users').children('.user_detail').css('display', 'block'); $('.dimmed').css('display', 'block');\"><span class=\"profileUrl\"><img src=\""+e.profileUrl+'"></span><span class="name">'+e.name+'</span><span class="level">'+e.level+"Lv | "+e.expPercent+'%</span><span class="pledge"><strong>'+(e.clanName?e.clanName:"-")+'</strong></span><span class="online">'+(e.onlineStatus?"접속중":"미접속")+"</span></div>"+get_user_detail(e)+"</li>"}):s='<div class="nodate">유저가 없습니다.</div>',$(".table-list").html(s)}})}const support_status={STANBY:"입금완료",FINISH:"정산완료"};function dropdown_select(t){let e=$(t).attr("data-textvalue");if(e===$(".ui-dropdown.is-active .select").find("span").html())return;$(".ui-dropdown.is-active .select").find("span").html(e),$(".ui-dropdown.is-active .select").find("#data_val").val($(t).attr("data-value"));let s=$(t).attr("data-value");$(".pagination").destory;let a=[];for(var n=0;n<support_container.length;n++)("ALL"===s||support_container[n].status===s)&&a.push(support_container[n]);support_render(a)}function dropdown_request_select(t){let e=$(t).attr("data-textvalue");if(e===$(".ui-dropdown.is-active .select").find("span").html())return;$(".ui-dropdown.is-active .select").find("span").html(e),$(".ui-dropdown.is-active .select").find("#data_val").val($(t).attr("data-value"));let s=$(t).attr("data-value");$(".pagination").destory;let a=[];for(var n=0;n<support_request_container.length;n++)("ALL"===s||"STANBY"===s&&!support_request_container[n].response||"FINISH"===s&&support_request_container[n].response)&&a.push(support_request_container[n]);support_render(a)}function support_finish(t){for(var e,s=0;s<support_container.length;s++)if(support_container[s].id===t){e=support_container[s];break}if(!e){alert("데이터가 특정되지 않았습니다.");return}if("FINISH"===e.status){alert("이미 정산이 완료된 데이터입니다.");return}confirm("선택한 항목을 정산하시겠습니까?")&&$.ajax({type:"post",datatype:"json",url:"/define/gm/supportfinish",data:{support_id:t},success:function(e){switch(e){case 1:support_container[s].status="FINISH",$("#support_"+t+" .item.status .val").text("정산완료"),$("#support_"+t+" .item.status .val").addClass("on"),$("#support_"+t+" .event .finish").remove(),alert("정상적으로 정산 되었습니다.");break;case 2:alert("정산할 데이터를 찾지 못하였습니다.");break;case 3:alert("이미 정산이 완료된 데이터입니다.");break;case 4:alert("정산할 금액이 최소 금액보다 부족합니다.");break;case 5:alert("고객이 인게임 내 존재하지 않습니다.");break;case 6:alert("고객의 부가서비스 창고에 등록하지 못하였습니다.");break;case 7:alert("정산이 완료되었으나 후원데이터를 업데이트하지 못하였습니다.");break;default:alert("정산에 실패하였습니다.")}},error:function(t,e,s){throw Error("support_finish from gm.js Error")}})}function support_request_finish(t){for(var e,s=0;s<support_request_container.length;s++)if(support_request_container[s].id===t){e=support_request_container[s];break}if(!e){alert("데이터가 특정되지 않았습니다.");return}if(void 0!==e.response){alert("이미 전송이 완료된 요청입니다.");return}$("#support_request_id").val(t),$(".dimmed").css("display","block"),$(".finish_form_div").css("display","block")}function support_request_finish_submit(){let t=$("#support_request_id").val();if(!t){alert("요청 번호를 찾지 못하였습니다.");return}for(var e,s=0;s<support_request_container.length;s++)if(support_request_container[s].id===Number(t)){e=support_request_container[s];break}if(!e){alert("데이터가 특정되지 않았습니다.");return}let a=$(".support_request_content").val();if(!a||!a.length){alert("계좌 정보를 입력하십시오.");return}confirm("계좌 정보를 해당 고객에게 전송하시겠습니까?")&&$.ajax({type:"post",datatype:"json",url:"/define/gm/supportBankResponse",data:{request_id:t,request_content:a},success:function(s){switch($(".finish_form_div").css("display","none"),$(".dimmed").css("display","none"),$(".support_request_content").val(""),s){case 1:e.response=a,$("#support_"+t+" .item.status .val").text("전송완료"),$("#support_"+t+" .item.status .val").addClass("on"),$("#support_"+t+" .event .finish").remove(),alert("정상적으로 전송 되었습니다.");break;case 2:alert("전송할 데이터를 찾지 못하였습니다.");break;case 3:alert("이미 전송이 완료된 데이터입니다.");break;case 4:alert("고객이 인게임 내 존재하지 않습니다.");break;case 5:alert("데이터를 업데이트하지 못하였습니다.");break;case 6:alert("전송할 편지 데이터를 등록하지 못하였습니다.");break;default:alert("전송에 실패하였습니다.")}},error:function(t,e,s){throw Error("support_request_finish_submit from gm.js Error")}})}function support_delete(t){confirm("선택한 항목을 삭제하시겠습니까?")&&$.ajax({type:"post",datatype:"json",url:"/define/gm/supportdelete",data:{support_id:t,type:support_tab_type},success:function(e){switch(e){case 1:if("DEFAULT"===support_tab_type){for(var s=0;s<support_container.length;s++)if(support_container[s].id===t){support_container.splice(s,1);break}}else for(var s=0;s<support_request_container.length;s++)if(support_request_container[s].id===t){support_request_container.splice(s,1);break}$("#support_"+t).remove(),alert("정상적으로 삭제 되었습니다.");break;case 2:alert("삭제할 데이터를 찾지 못하였습니다.");break;default:alert("삭제에 실패하였습니다.")}},error:function(t,e,s){throw Error("support_delete from gm.js Error")}})}function support_tab_click(t){t!==support_tab_type&&(support_tab_type=t,init(),support_render("DEFAULT"===support_tab_type?support_container:support_request_container))}function support_render(t){$(".pagination").pagination({dataSource:t,pageSize:20,showPrevious:!1,showNext:!1,showPageNumbers:!0,callback:function(t,e){if(t&&t.length){if("DEFAULT"===support_tab_type){let s=t.map((t,e)=>'<li class="supports" id="support_'+t.id+'"><span class="item account"><span class="key">ACCOUNT</span><span class="val">'+t.account_name+'</span></span><span class="item character"><span class="key">CHARACTER</span><span class="val">'+t.character_name+'</span></span><span class="item pay"><span class="key">PAY</span><span class="val">'+commaAdd(t.pay_amount)+'원</span></span><span class="item date"><span class="key">DATE</span><span class="val">'+moment(new Date(t.write_date)).format("YY.MM.DD.HH:mm")+'</span></span><span class="item status"><span class="key">STATUS</span><span class="val '+("FINISH"===t.status?"on":"")+'">'+support_status[t.status]+'</span></span><span class="event">'+("FINISH"!==t.status?'<button class="finish" onClick="support_finish('+t.id+')">정산</button>':"")+'<button onClick="support_delete('+t.id+')">삭제</button></span>').join("");$(".table-list").html(s)}else{let a=t.map((t,e)=>'<li class="supports" id="support_'+t.id+'"><span class="item account"><span class="key">ACCOUNT</span><span class="val">'+t.account_name+'</span></span><span class="item character"><span class="key">CHARACTER</span><span class="val">'+t.character_name+'</span></span><span class="item date"><span class="key">REQUEST_DATE</span><span class="val">'+moment(new Date(t.request_date)).format("YY.MM.DD.HH:mm")+'</span></span><span class="item status"><span class="key">STATUS</span><span class="val '+(t.response?"on":"")+'">'+(t.response?"전송완료":"미전송")+'</span></span><span class="event">'+(void 0===t.response?'<button class="finish" onClick="support_request_finish('+t.id+')">전송</button>':"")+'<button onClick="support_delete('+t.id+')">삭제</button></span>').join("");$(".table-list").html(a)}}else"DEFAULT"===support_tab_type?$(".table-list").html('<div class="nodate">후원내역이 없습니다.</div>'):$(".table-list").html('<div class="nodate">계좌요청이 없습니다.</div>')}})}function restrict_cancel(){$(".restrict_form").removeClass("is-active")}function restrict_ok(){let t=$("#restrict_account").val();if(!t){alert("계정명을 입력하십시오.");return}let e=$("#restrict_time").val();if(!e){alert("제재일을 선택하십시오.");return}confirm("정말로 이용제제를 하시겠습니까?")&&$.ajax({type:"post",datatype:"json",url:"/define/gm/restrict",data:{account_name:t,restrict_time:e},success:function(t){t?alert("정상적으로 적용 되었습니다."):alert("적용에 실패 하였습니다.")},error:function(t,e,s){throw Error("restrict_ok gm.js Error")}})}function restrict_form_show(){let t=$(".restrict_form");if(t.hasClass("is-active"))return;t.addClass("is-active");let e=new Date().toISOString().substring(0,10);$("#restrict_time").val(e)}function report_move(t,e){if(confirm("선택한 항목으로 이동하시겠습니까?")){if("BOARD"===t){urlform(e,"post","/board/view");return}if("CONTENTS"===t){urlform(e,"post","/contents/view");return}if("PTICH"===t){urlform(e,"post","/pitch/view");return}}}function report_delete(t){confirm("선택한 항목을 삭제하시겠습니까?")&&$.ajax({type:"post",datatype:"json",url:"/define/gm/reportdelete",data:{report_id:t},success:function(e){switch(e){case 1:$("#report_"+t).remove(),alert("정상적으로 삭제 되었습니다.");break;case 2:alert("삭제할 데이터를 찾지 못하였습니다.");break;default:alert("삭제에 실패하였습니다.")}},error:function(t,e,s){throw Error("report_delete from gm.js Error")}})}const report_type={LEWDNESS:"음란성",ABUSIVE:"욕설",ADVERTISE:"일반광고",ILLEGALITY_PROGRAM:"불법프로그램",OVER_CONTENT:"도배",PERSONAL_INFORMATION:"개인정보",SPEAK_ILL:"타인비방",ETC:"기타"};function report_render(t){$(".pagination").pagination({dataSource:t,pageSize:20,showPrevious:!1,showNext:!1,showPageNumbers:!0,callback:function(t,e){var s="";t&&t.length?$.each(t,function(t,e){s+='<li class="reports" id="report_'+e.id+'"><span class="item name"><span class="key">NAME</span><span class="val">'+e.name+'</span></span><span class="item targetName"><span class="key">TARGET</span><span class="val">'+e.targetName+'</span></span><span class="item type"><span class="key">TYPE</span><span class="val">'+report_type[e.type]+'</span></span><span class="item log"><span class="key">LOG</span><span class="val">'+e.log+'</span></span><span class="item date"><span class="key">DATE</span><span class="val">'+moment(new Date(e.date)).format("YY.MM.DD.HH:mm")+'</span></span><span class="event"><button onClick="report_move(\''+e.obj.board_type+"', "+e.obj.rownum+')">이동</button><button onClick="report_delete('+e.id+')">삭제</button></span>'}):s='<div class="nodate">신고내역이 없습니다.</div>',$(".table-list").html(s)}})}function dropdown_coupon_select(t){let e=$(t).attr("data-textvalue");if(e===$(".ui-dropdown.is-active .select").find("span").html())return;$(".ui-dropdown.is-active .select").find("span").html(e),$(".ui-dropdown.is-active .select").find("#data_val").val($(t).attr("data-value"));let s=$(t).attr("data-value");switch($(".pagination").destory,s){case"0":let a=[];for(var n=0;n<coupon_container.length;n++)coupon_container[n].useTime||a.push(coupon_container[n]);coupon_render(a);break;case"1":let o=[];for(var n=0;n<coupon_container.length;n++)coupon_container[n].useTime&&o.push(coupon_container[n]);coupon_render(o);break;default:coupon_render(coupon_container)}}function dropdown_coupon_create_select(t){let e=$(t).attr("data-textvalue");if(e===$(".ui-dropdown.is-active .select").find("span").html())return;let s=$(t).attr("data-value");$(".ui-dropdown.is-active .select").find("span").html(e),$(".ui-dropdown.is-active .select").find("#data_val").val(s),"ITEM"===s?$(".coupon-create-div .coupon-create-area.itemId").css("display","block"):$(".coupon-create-div .coupon-create-area.itemId").css("display","none")}function couponPopOpen(){$(".coupon-create-pop").css("display","block"),$(".coupon-create-pop-back").css("display","block")}function couponPopClose(){$(".coupon-create-pop").css("display","none"),$(".coupon-create-pop-back").css("display","none")}function couponCreate(){if(!couponCreateForm.couponType.value)return popupShow("쿠폰타입을 설정해주세요.",'<span class="type2"><a href="javascript:popupClose();" class="close">확인</a></span>',null),!1;if(!couponCreateForm.couponAmount.value)return popupShow("수량을 입력해주세요.",'<span class="type2"><a href="javascript:popupClose();" class="close">확인</a></span>',null),!1;if(!couponCreateForm.couponEnableTime.value||!couponCreateForm.couponExpireTime.value)return popupShow("기간 설정을 선택해주세요.",'<span class="type2"><a href="javascript:popupClose();" class="close">확인</a></span>',null),!1;if(couponCreateForm.couponExpireTime.value<=couponCreateForm.couponEnableTime.value)return popupShow("기간 설정이 올바르지 않습니다.",'<span class="type2"><a href="javascript:popupClose();" class="close">확인</a></span>',null),!1;let t=0;switch(couponCreateForm.couponType.value){case"ITEM":if(!couponCreateForm.couponItemId.value)return popupShow("아이템 번호를 입력하십시오..",'<span class="type2"><a href="javascript:popupClose();" class="close">확인</a></span>',null),!1;t=couponCreateForm.couponItemId.value;break;case"NCOIN":t=0;break;case"NPOINT":t=-1}let e={itemId:t,amount:couponCreateForm.couponAmount.value,enableTime:couponCreateForm.couponEnableTime.value,expireTime:couponCreateForm.couponExpireTime.value};return $.ajax({type:"post",datatype:"json",url:"/define/gm/couponcreate",data:e,success:function(t){switch(t){case 1:popupShow("정상적으로 생성되었습니다.",'<span class="type2"><a href="javascript:popupCloseReload();" class="close">닫기</a></span>',null);break;case 2:popupShow("관리자 계정을 찾을 수 없습니다.",'<span class="type2"><a href="javascript:popupClose();" class="close">닫기</a></span>',null);break;case 3:popupShow("존재하지 않는 아이템번호입니다.",'<span class="type2"><a href="javascript:popupClose();" class="close">닫기</a></span>',null);break;default:popupShow("쿠폰생성에 실패하였습니다.",'<span class="type2"><a href="javascript:popupClose();" class="close">닫기</a></span>',null)}},error:function(t,e,s){throw Error("couponCreate Error")}}),!1}function couponAmountCheck(t){let e=checkDigit(t.value);e>1e6?t.value=1e6:e<1?t.value=1:t.value=e}function deleteCoupon(t){confirm("삭제하시겠습니까?")&&$.ajax({type:"post",datatype:"json",url:"/define/gm/coupondelete",data:{number:t},success:function(e){if(popupShow(e?"정상적으로 삭제되었습니다.":"삭제에 실패하였습니다.",'<span class="type2"><a href="javascript:popupClose();" class="close">닫기</a></span>',null),e){for(var s=0;s<coupon_container.length;s++)if(coupon_container[s].number===t){coupon_container.splice(s,1);break}$(".pagination").destory,coupon_render(coupon_container)}},error:function(t,e,s){throw Error("couponCreate Error")}})}function coupon_render(t){$(".pagination").pagination({dataSource:t,pageSize:10,showPrevious:!1,showNext:!1,showPageNumbers:!0,callback:function(t,e){var s="";t&&t.length?$.each(t,function(t,e){s+="<tr><td>"+e.number+'</td><td class="subject">'+e.descrption+"</td><td>"+moment(new Date(e.enableTime)).format("YY.MM.DD")+" ~ "+(e.expireTime?moment(new Date(e.expireTime)).format("YY.MM.DD"):"")+"</td><td>"+moment(new Date(e.createTime)).format("YY.MM.DD")+"</td><td>"+e.creatorName+"</td><td>"+(e.useTime?"사용완료":"미사용")+"</td><td>"+(e.useTime?moment(new Date(e.useTime)).format("YY.MM.DD"):"-")+"</td><td>"+(e.ownerAccount?e.ownerAccount:"-")+'</td><td><button class="btn_util" onClick="deleteCoupon(\''+e.number+"');\">삭제</button></td></tr>"}):s='<div class="nodate">쿠폰내역이 없습니다.</div>',$(".couponList").html(s)}})}let call_flag=!1;function call_data(){if(call_flag||"PERFORM"==tabType||"CHAT"==tabType)return;let t={typeFlag:tabType};call_flag=!0,$.ajax({type:"post",datatype:"json",url:"/define/gm",data:t,success:function(t){switch(tabType){case"USER":user_render(t),user_container=t;break;case"SUPPORT":support_render(t.DEFAULT),support_container=t.DEFAULT,support_request_container=t.REQUEST;break;case"REPORT":report_render(t);break;case"COUPON":coupon_render(t),coupon_container=t}call_flag=!1},error:function(t,e,s){clearInterval(update_interval),call_flag=!1}})}$(function(){$("a[data-type="+tabType+"]").addClass("on"),init(),$("#mypageTab").find("li").on("click",function(t){var e=$(this).children("a").attr("data-type");tabType!=e&&("PERFORM"==e?perform_run():"PERFORM"==tabType&&perform_stop(),$("a[data-type="+tabType+"]").removeClass("on"),tabType=e,$("a[data-type="+tabType+"]").addClass("on"),support_tab_type="DEFAULT",init(),call_data())})});